class e extends Error{constructor(t,n,r){super("object"==typeof n?n.message:n||t,{cause:"object"==typeof n?n.cause:r}),this.type=t,this.name="TypedError",Object.setPrototypeOf(this,e.prototype)}}const t="ERR_PARSE";function n(t){let n=t;if("string"==typeof n)try{n=JSON.parse(n)}catch(r){throw new e("ERR_INVALID_VALUE",{cause:r})}if("object"!=typeof n||!n||Array.isArray(n))throw new e("ERR_UNEXPECTED_VALUE");return n}function r(n,r){return o=>{const s=s=>{if(!o||void 0!==s)try{return r(s)}catch(i){throw new e(t,{message:`"${n}" transformer failed to parse the value`,cause:i})}};return Object.assign(s,{isValid(e){try{return s(e),!0}catch{return!1}}})}}function o(o,s){return r("object",(r=>{const s=n(r);return function(n,r){const o={};for(const i in n){const a=n[i];if(!a)continue;let c,u;"function"==typeof a?(c=i,u=a):[c,u]=a;try{const e=u(r(c));void 0!==e&&(o[i]=e)}catch(s){throw new e(t,`Parser for "${i}" property failed${c===i?"":`. Source field: "${c}"`}`,s)}}return o}(o,(e=>s[e]))}))}function s(t){throw new e("ERR_UNEXPECTED_TYPE",`Unexpected value received: ${JSON.stringify(t)}`)}const i=r("string",(e=>{if("string"==typeof e||"number"==typeof e)return e.toString();s(e)}));function a(e){return/^#[\da-f]{6}$/i.test(e)}const c=r("rgb",(e=>function(e){const t=e.replace(/\s/g,"").toLowerCase();if(a(t))return t;if(function(e){return/^#[\da-f]{3}$/i.test(e)}(t)){let e="#";for(let n=0;n<3;n+=1)e+=t[1+n].repeat(2);return e}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce(((e,t)=>{const n=parseInt(t,10).toString(16);return e+(1===n.length?"0":"")+n}),"#")}(i()(e)))),u=r("themeParams",(e=>{const t=c(!0);return Object.entries(n(e)).reduce(((e,[n,r])=>(e[function(e){return e.replace(/_[a-z]/g,(e=>e[1].toUpperCase()))}(n)]=t(r),e)),{})}));class p extends Error{constructor(e,t,n){super("object"==typeof t?t.message:t||e,{cause:"object"==typeof t?t.cause:n}),this.type=e,this.name="TypedError",Object.setPrototypeOf(this,p.prototype)}}function l(e){return e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))}const _="ERR_PARSE";function f(e,t){const n={};for(const o in e){const s=e[o];if(!s)continue;let i,a;"function"==typeof s?(i=o,a=s):[i,a]=s;try{const e=a(t(i));void 0!==e&&(n[o]=e)}catch(r){throw new p(_,`Parser for "${o}" property failed${i===o?"":`. Source field: "${i}"`}`,r)}}return n}function d(e){let t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(n){throw new p("ERR_INVALID_VALUE",{cause:n})}if("object"!=typeof t||!t||Array.isArray(t))throw new p("ERR_UNEXPECTED_VALUE");return t}function h(e,t){return n=>{const r=r=>{if(!n||void 0!==r)try{return t(r)}catch(o){throw new p(_,{message:`"${e}" transformer failed to parse the value`,cause:o})}};return Object.assign(r,{isValid(e){try{return r(e),!0}catch{return!1}}})}}function b(e,t){return h(t||"object",(t=>{const n=d(t);return f(e,(e=>n[e]))}))}function w(e){throw new p("ERR_UNEXPECTED_TYPE",`Unexpected value received: ${JSON.stringify(e)}`)}const g=h("boolean",(e=>{if("boolean"==typeof e)return e;const t=String(e);return"1"===t||"true"===t||"0"!==t&&"false"!==t&&void w(e)})),m=h("string",(e=>{if("string"==typeof e||"number"==typeof e)return e.toString();w(e)})),y=h("number",(e=>{if("number"==typeof e)return e;if("string"==typeof e){const t=Number(e);if(!Number.isNaN(t))return t}w(e)})),v=h("date",(e=>e instanceof Date?e:new Date(1e3*y()(e))));function E(e,t){return h(t||"searchParams",(t=>{"string"!=typeof t&&!(t instanceof URLSearchParams)&&w(t);const n="string"==typeof t?new URLSearchParams(t):t;return f(e,(e=>{const t=n.get(e);return null===t?void 0:t}))}))}function A(e){for(const t in e)e[t]=[l(t),e[t]];return e}const S=e=>{const t=y(),n=y(!0),r=m(),o=m(!0),s=g(!0),i=b(A({addedToAttachmentMenu:s,allowsWriteToPm:s,firstName:r,id:t,isBot:s,isPremium:s,languageCode:o,lastName:o,photoUrl:o,username:o}),"User")(!0);return E(A({authDate:v(),canSendAfter:n,chat:b(A({id:t,type:r,title:r,photoUrl:o,username:o}),"Chat")(!0),chatInstance:o,chatType:o,hash:r,queryId:o,receiver:i,startParam:o,signature:r,user:i}),"initData")(e)};const R=h("rgb",(e=>function(e){const t=e.replace(/\s/g,"").toLowerCase();if(function(e){return/^#[\da-f]{6}$/i.test(e)}(t))return t;if(function(e){return/^#[\da-f]{3}$/i.test(e)}(t)){let e="#";for(let n=0;n<3;n+=1)e+=t[1+n].repeat(2);return e}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce(((e,t)=>{const n=parseInt(t,10).toString(16);return e+(1===n.length?"0":"")+n}),"#")}(m()(e)))),C=h("themeParams",(e=>{const t=R(!0);return Object.entries(d(e)).reduce(((e,[n,r])=>(e[function(e){return e.replace(/_[a-z]/g,(e=>e[1].toUpperCase()))}(n)]=t(r),e)),{})}));function $(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map((([e,t])=>[l(e),t]))))}function k(e){const{initDataRaw:t,startParam:n,showSettings:r,botInline:o,fullscreen:s,defaultColors:i}=e,a=new URLSearchParams;return a.set("tgWebAppPlatform",e.platform),a.set("tgWebAppThemeParams",$(e.themeParams)),a.set("tgWebAppVersion",e.version),t&&a.set("tgWebAppData",t),n&&a.set("tgWebAppStartParam",n),"boolean"==typeof r&&a.set("tgWebAppShowSettings",r?"1":"0"),"boolean"==typeof o&&a.set("tgWebAppBotInline",o?"1":"0"),"boolean"==typeof s&&a.set("tgWebAppFullscreen",s?"1":"0"),i&&a.set("tgWebAppDefaultColors",$(i)),a.toString()}const x=b({eventType:m(),eventData:e=>e},"miniAppsMessage"),I=h("fn",(e=>{if("function"==typeof e)return e;w(e)})),P=b({TelegramWebviewProxy:b({postEvent:I()})()});function O(e){return P().isValid(e)}var T=Object.defineProperty,L=(e,t,n)=>((e,t,n)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let j=class e extends Error{constructor(t,n,r){super("object"==typeof n?n.message:n||t,{cause:"object"==typeof n?n.cause:r}),this.type=t,this.name="TypedError",Object.setPrototypeOf(this,e.prototype)}};function D(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function N(...e){const t=e.flat(1);return[t.push.bind(t),()=>{t.forEach((e=>{e()}))}]}function q(e){return new j("ERR_ABORTED",{cause:e})}function U(e,t){return e.reject=t.reject,e}class V extends Promise{constructor(e,t){let n,r,o,s;"function"==typeof e?(n=e,r=t):r=e,super(((e,t)=>{r||(r={});const{abortSignal:i}=r;if(i&&i.aborted)return t(q(i.reason));const[a,c]=N(),u=e=>(...t)=>(c(),e(...t)),p=new AbortController,{signal:l}=p;s=u((e=>{p.abort(e),t(e)})),o=u(e),i&&a(D(i,"abort",(()=>{s(q(i.reason))})));const{timeout:_}=r;if(_){const e=setTimeout((()=>{s(new j("ERR_TIMED_OUT",`Timeout reached: ${_}ms`))}),_);a((()=>{clearTimeout(e)}))}n&&n(o,s,l)})),L(this,"reject"),this.reject=s}static withFn(e,t){return new V(((t,n,r)=>{try{const o=e(r);return o instanceof Promise?o.then(t,n):t(o)}catch(o){n(o)}}),t)}static resolve(e){return new V((t=>{t(e)}))}static reject(e){return new V(((t,n)=>{n(e)}))}cancel(){this.reject(new j("ERR_CANCELED"))}catch(e){return this.then(void 0,e)}finally(e){return U(super.finally(e),this)}then(e,t){return U(super.then(e,t),this)}}function B(e,t){return e.resolve=t.resolve,e}let W=class e extends V{constructor(e,t){let n,r,o;"function"==typeof e?(n=e,r=t):r=e,super(((e,t,r)=>{o=e,n&&n(e,t,r)}),r),L(this,"resolve"),this.resolve=o}static withFn(t,n){return new e(((e,n,r)=>V.withFn(t,{abortSignal:r}).then(e,n)),n)}static resolve(t){return new e((e=>{e(t)}))}static reject(t){return new e(((e,n)=>{n(t)}))}catch(e){return this.then(void 0,e)}finally(e){return B(super.finally(e),this)}then(e,t){return B(super.then(e,t),this)}};function F(e){return`tapps/${e}`}function M(e,t){sessionStorage.setItem(F(e),JSON.stringify(t))}function H(e){const t=sessionStorage.getItem(F(e));try{return t?JSON.parse(t):void 0}catch{}}function J(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}function G(e,t){t||(t={});const{textColor:n,bgColor:r,shouldLog:o=!0}=t;function s(t,...s){if(!o||"function"==typeof o&&!o())return;const i="font-weight:bold;padding:0 5px;border-radius:5px";console[t](`%c${Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date)}%c / %c${e}`,`${i};background-color: lightblue;color:black`,"",`${i};${n?`color:${n};`:""}${r?`background-color:${r}`:""}`,...s)}return[function(...e){s("log",...e)},function(...e){s("error",...e)}]}function Y(e,t){document.documentElement.style.setProperty(e,t)}function K(e){document.documentElement.style.removeProperty(e)}function Z(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=e=>{if(!n(o,e)){const t=o;o=e,function(e,t){t()}(0,(()=>{[...r].forEach((([n,r])=>{n(e,t),r&&a(n,!0)}))}))}};function i(e){const t="object"!=typeof e?{once:e}:e;return{once:t.once||!1,signal:t.signal||!1}}const a=(e,t)=>{const n=i(t),o=r.findIndex((([t,r])=>t===e&&r.once===n.once&&r.signal===n.signal));o>=0&&r.splice(o,1)},c=Object.assign((function(){return function(e){z.length&&z[z.length-1].add(e)}(c),o}),{destroy(){r=[]},set:s,reset(){s(e)},sub:(e,t)=>(r.push([e,i(t)]),()=>a(e,t)),unsub:a,unsubAll(){r=r.filter((e=>e[1].signal))}});return c}const z=[];const X=Z(!1),[Q,ee]=G("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog:X}),te={clipboard_text_received:b({req_id:m(),data:e=>null===e?e:m(!0)(e)},"clipboard_text_received"),custom_method_invoked:b({req_id:m(),result:e=>e,error:m(!0)},"custom_method_invoked"),popup_closed:h("popup_closed",(e=>e?b({button_id:e=>null==e?void 0:m()(e)})()(e):{})),viewport_changed:b({height:y(),width:e=>null==e?window.innerWidth:y()(e),is_state_stable:g(),is_expanded:g()},"viewport_changed")};const ne=Z(),re=Z();function oe(){return re()||re.set(function(e){const t=window,[,n]=N(D(t,"message",(n=>{if(n.source!==t.parent)return;let r;try{r=x()(n.data)}catch{return}const{eventType:o,eventData:s}=r,i=te[o];try{const t=i?i()(s):s;Q("Event received:",t?{eventType:o,eventData:t}:{eventType:o}),e([o,t])}catch(a){ee([`An error occurred processing the "${o}" event from the Telegram application.`,"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join("\n"),r,a)}})));return n}(ne.set)),ne}const se=Z({});function ie(e){let t=se()[e];return t||(t=Z(void 0,{equals:()=>!1}),oe().sub((n=>{n&&n[0]===e&&t.set(n[1])})),se.set({...se(),[e]:t})),t}function ae(e,t,n){return ie(e).sub(t,n)}const ce="ERR_UNKNOWN_ENV",ue=Z("https://web.telegram.org");function pe(e,t){Q("Posting event:",t?{eventType:e,eventData:t}:{eventType:e});const n=window;if(O(n))return void n.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));const r=JSON.stringify({eventType:e,eventData:t});if(function(){try{return window.self!==window.top}catch{return!0}}())return n.parent.postMessage(r,ue());const{external:o}=n;if(!b({notify:I()})().isValid(o))throw new j(ce);o.notify(r)}function le(e,t,n){n||(n={});const{capture:r}=n,[o,s]=N();return new V((s=>{(Array.isArray(t)?t:[t]).forEach((e=>{o(ae(e,(n=>{(!r||(Array.isArray(t)?r({event:e,payload:n}):r(n)))&&s(n)})))})),(n.postEvent||pe)(e,n.params)}),n).finally(s)}function _e(e){return(e=>{const t=m(),n=m(!0),r=g(!0);return E({botInline:["tgWebAppBotInline",r],defaultColors:["tgWebAppDefaultColors",C(!0)],fullscreen:["tgWebAppFullscreen",r],initData:["tgWebAppData",S(!0)],initDataRaw:["tgWebAppData",n],platform:["tgWebAppPlatform",t],showSettings:["tgWebAppShowSettings",r],startParam:["tgWebAppStartParam",n],themeParams:["tgWebAppThemeParams",C()],version:["tgWebAppVersion",t]},"launchParams")(e)})()(e)}function fe(e){return _e(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function de(){return fe(window.location.href)}function he(){const e=performance.getEntriesByType("navigation")[0];if(!e)throw new Error("Unable to get first navigation entry.");return fe(e.name)}function be(){return _e(H("launchParams")||"")}function we(e){M("launchParams",k(e))}function ge(e){return e instanceof Error?e.message+(e.cause?`\n  ${ge(e.cause)}`:""):JSON.stringify(e)}function me(){const e=[];for(const n of[de,he,be])try{const e=n();return we(e),e}catch(t){e.push(t)}throw new j("ERR_RETRIEVE_LP_FAILED",["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","ðŸ“– Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-bridge/environment","Collected errors:",...e.map((e=>`â€” ${ge(e)}`))].join("\n"))}function ye(e){try{return me(),!0}catch{return!1}return V.withFn((async()=>{if(O(window))return!0;try{return await le("web_app_request_theme","theme_changed",{timeout:100}),!0}catch{return!1}}),e)}function ve(e,t,n){ie(e).unsub(t,n)}function Ee(e){return({req_id:t})=>t===e}function Ae(e){return e.split(".").map(Number)}function Se(e,t){return function(e,t){const n=Ae(e),r=Ae(t),o=Math.max(n.length,r.length);for(let s=0;s<o;s+=1){const e=n[s]||0,t=r[s]||0;if(e!==t)return e>t?1:-1}return 0}(e,t)<=0}function Re(e,t,n){if("string"==typeof n){if("web_app_open_link"===e){if("try_instant_view"===t)return Se("6.4",n);if("try_browser"===t)return Se("7.6",n)}if("web_app_set_header_color"===e&&"color"===t)return Se("6.9",n);if("web_app_close"===e&&"return_back"===t)return Se("7.6",n);if("web_app_setup_main_button"===e&&"has_shine_effect"===t)return Se("7.10",n)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return Se("6.1",t);case"web_app_open_popup":return Se("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return Se("6.4",t);case"web_app_switch_inline_query":return Se("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return Se("6.9",t);case"web_app_setup_settings_button":return Se("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return Se("7.2",t);case"web_app_setup_swipe_behavior":return Se("7.7",t);case"web_app_share_to_story":return Se("7.8",t);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return Se("7.10",t);case"web_app_request_safe_area":case"web_app_request_content_safe_area":case"web_app_request_fullscreen":case"web_app_exit_fullscreen":case"web_app_set_emoji_status":case"web_app_add_to_home_screen":case"web_app_check_home_screen":case"web_app_request_emoji_status_access":return Se("8.0",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function Ce(){const e=performance.getEntriesByType("navigation")[0];return!!e&&"reload"===e.type}let $e;function ke(e){if($e)return e();$e=new Map;try{e()}finally{$e.forEach((e=>e())),$e=void 0}}function xe(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=e=>{if(!n(o,e)){const t=o;o=e,function(e,t){$e&&$e.set(e,t)||t()}(c,(()=>{[...r].forEach((([n,r])=>{n(e,t),r&&a(n,!0)}))}))}};function i(e){const t="object"!=typeof e?{once:e}:e;return{once:t.once||!1,signal:t.signal||!1}}const a=(e,t)=>{const n=i(t),o=r.findIndex((([t,r])=>t===e&&r.once===n.once&&r.signal===n.signal));o>=0&&r.splice(o,1)},c=Object.assign((function(){return function(e){Ie.length&&Ie[Ie.length-1].add(e)}(c),o}),{destroy(){r=[]},set:s,reset(){s(e)},sub:(e,t)=>(r.push([e,i(t)]),()=>a(e,t)),unsub:a,unsubAll(){r=r.filter((e=>e[1].signal))}});return c}const Ie=[];function Pe(e,t){let n,r=new Set;function o(){return n||(n=xe(i(),t))}function s(){o().set(i())}function i(){r.forEach((e=>{e.unsub(s,{signal:!0})}));const t=new Set;let n;Ie.push(t);try{n=e()}finally{Ie.pop()}return t.forEach((e=>{e.sub(s,{signal:!0})})),r=t,n}return Object.assign((function(){return o()()}),{destroy(){o().destroy()},sub:(...e)=>o().sub(...e),unsub(...e){o().unsub(...e)},unsubAll(...e){o().unsubAll(...e)}})}const Oe=xe((()=>{let e=0;return()=>(e+=1).toString()})()),Te=xe(pe),Le=xe("0.0");function je(e,t,n){return function(e,t,n,r){return le("web_app_invoke_custom_method","custom_method_invoked",{...r||{},params:{method:e,params:t,req_id:n},capture:Ee(n)}).then((({result:e,error:t})=>{if(t)throw new j("ERR_INVOKE_CUSTOM_METHOD_RESPONSE",t);return e}))}(e,t,Oe()(),{...n||{},postEvent:Ne})}const De=(e,t,n)=>(n||(n={}),n.postEvent||(n.postEvent=Ne),le(e,t,n)),Ne=(e,t)=>Te()(e,t),qe="ERR_POPUP_INVALID_PARAMS",Ue="ERR_INVALID_URL",Ve="ERR_ALREADY_REQUESTING",Be="ERR_ALREADY_OPENED",We="ERR_NOT_SUPPORTED";function Fe(){return typeof window>"u"}function Me(e,t,{isSupported:n,isMounted:r,component:o,supports:s}={}){const i=`${o?`${o}.`:""}${e}()`;function a(e){if(s){const t=s[e];return Re(t[0],t[1],Le())}return!0}n=n?Array.isArray(n)||"object"==typeof n&&"any"in n?n:[n]:void 0;const c=()=>{if(!n)return;const e=`it is unsupported in Mini Apps version ${Le()}`;function t(t){return"string"==typeof t?Re(t,Le())?void 0:e:t.fn()?void 0:t.error}if(Array.isArray(n)){for(const e of n){const n=t(e);if(n)return n}return}let r;for(const o of n.any)if(r=t(o),!r)return;return e},u=Pe((()=>!c())),p=Pe((()=>"0.0"!==Le())),l=Pe((()=>!r||r())),_=Pe((()=>ye("simple")&&!Fe()&&p()&&u()&&l()));let f;if(s){f={};for(const e in s)f[e]=Pe((()=>a(e)))}return Object.assign(((...e)=>{const n=`Unable to call the ${i} ${o?"method":"function"}:`;if(Fe()||!ye("simple"))throw new j(ce,`${n} it can't be called outside Mini Apps`);if(!p())throw new j("ERR_NOT_INITIALIZED",`${n} the SDK was not initialized. Use the SDK init() function`);const r=c();if(r)throw new j(We,`${n} ${r}`);const u=((...e)=>{if(s)for(const t in s)if(s[t][2](...e)&&!a(t))return`option ${t} is not supported in Mini Apps version ${Le()}`})(...e);if(u)throw new j(We,`${n} ${u}`);if(!l())throw new j("ERR_NOT_MOUNTED",`${n} the component is not mounted. Use the ${o}.mount() method`);return t(...e)}),t,{isAvailable:_,ifAvailable:(...e)=>_()?t(...e):void 0},n?{isSupported:u}:{},f?{supports:f}:{})}function He(e,t){return t||(t={}),(n,r,o,s)=>Me(n,r,{...t,isSupported:o||t.isSupported,supports:s,component:e})}function Je(e,t,n){return He(e,{isSupported:n,isMounted:t})}function Ge(e,t){return He(e,{isSupported:t})}const Ye="web_app_setup_back_button",Ke="back_button_pressed",Ze="backButton",ze=xe(!1),Xe=xe(!1),Qe=Je(Ze,Xe,Ye),et=Ge(Ze,Ye);function tt(e){e!==ze()&&(Ne(Ye,{is_visible:e}),M(Ze,e),ze.set(e))}function nt(e,t,n,r,o){const s=void 0===o||o?V:Promise;return Object.assign(((...o)=>s.resolve().then((async()=>{if(n()){const e=t();throw r.set(e),e}let i;ke((()=>{n.set(s.resolve(e(...o))),r.set(void 0)}));try{i=[!0,await n()]}catch(a){i=[!1,a]}if(ke((()=>{n.set(void 0),r.set(i[0]?void 0:i[1])})),!i[0])throw i[1];return i[1]}))),e)}function rt(e,t,n,r,o,s){const i=nt(t,(()=>new j("ERR_ALREADY_MOUNTING",`The ${e} component is already mounting`)),o,s);return e=>V.resolve().then((async()=>{if(!r()){const t=await i(e);ke((()=>{r.set(!0),n(t)}))}}))}Qe("hide",(()=>{tt(!1)})),et("mount",(()=>{Xe()||(tt(Ce()&&H(Ze)||!1),Xe.set(!0))})),et("onClick",(e=>ae(Ke,e))),et("offClick",(e=>{ve(Ke,e)})),Qe("show",(()=>{tt(!0)}));const ot=He,st=xe({available:!1}),it=xe(!1),at=xe(!1),ct=xe(!1),ut=xe(),pt=xe();function lt(e){return e.available?{available:!0,tokenSaved:e.token_saved,deviceId:e.device_id,accessRequested:e.access_requested,type:e.type,accessGranted:e.access_granted}:{available:!1}}const _t="web_app_biometry_get_info",ft=Me("requestBiometry",(e=>De(_t,"biometry_info_received",e).then(lt)),{isSupported:_t}),dt="web_app_biometry_request_auth",ht="biometry_info_received",bt="biometry",wt=ot(bt),gt=Ge(bt,dt),mt=Je(bt,ct,dt);function yt(){throw new j("ERR_NOT_AVAILABLE","Biometry is not available")}mt("authenticate",(e=>V.withFn((async t=>{if(it())throw new j(Ve,"Authentication is already in progress");const n=st();(!n||!n.available)&&yt(),it.set(!0);try{const r=await De(dt,"biometry_auth_requested",{abortSignal:t,params:{reason:((e||{}).reason||"").trim()}}),{token:o}=r;return"string"==typeof o&&Et({...n,token:o}),r}finally{it.set(!1)}}),e))),gt("openSettings",(()=>{Ne("web_app_biometry_open_settings")})),mt("requestAccess",(e=>V.withFn((async t=>{if(at())throw new j(Ve,"Access request is already in progress");at.set(!0);try{const n=await De("web_app_biometry_request_access",ht,{abortSignal:t,params:{reason:(e||{}).reason||""}}).then(lt);return n.available||yt(),Et(n),n.accessGranted}finally{at.set(!1)}}),e))),wt("mount",rt(bt,(e=>Ce()&&H(bt)||ft(e)),(e=>{ae(ht,vt),Et(e)}),ct,pt,ut));const vt=e=>{Et(lt(e))};function Et(e){st.set(e),M(bt,e)}function At(e,t){return He(e,{isMounted:t})}mt("updateToken",(e=>(e||(e={}),De("web_app_biometry_update_token","biometry_token_updated",{...e,params:{token:e.token||"",reason:e.reason}}).then((e=>e.status)))));const St="closingBehavior",Rt=xe(!1),Ct=xe(!1),$t=At(St,Ct),kt=ot(St);function xt(e){e!==Rt()&&(Ne("web_app_setup_closing_behavior",{need_confirmation:e}),M(St,e),Rt.set(e))}$t("disableConfirmation",(()=>{xt(!1)})),$t("enableConfirmation",(()=>{xt(!0)})),kt("mount",(()=>{Ct()||(xt(Ce()&&H(St)||!1),Ct.set(!0))}));const It=Ge("cloudStorage","web_app_invoke_custom_method");It("deleteItem",((e,t)=>{const n=Array.isArray(e)?e:[e];return n.length?je("deleteStorageValues",{keys:n},t).then():V.resolve()})),It("getItem",(function(e,t){const n=Array.isArray(e)?e:[e];return n.length?je("getStorageValues",{keys:n},t).then((t=>{const r=o(Object.fromEntries(n.map((e=>[e,i()]))))()(t);return Array.isArray(e)?r:r[e]})):V.resolve("string"==typeof e?"":{})})),It("getKeys",(e=>je("getStorageKeys",{},e).then(function(e){return r("array",(t=>{let n;if(Array.isArray(t))n=t;else if("string"==typeof t)try{const e=JSON.parse(t);Array.isArray(e)&&(n=e)}catch{}return n||s(t),n.map(e)}))}(i())()))),It("setItem",((e,t,n)=>je("saveStorageValue",{key:e,value:t},n).then()));const Pt="web_app_trigger_haptic_feedback",Ot=Ge("hapticFeedback",Pt);Ot("impactOccurred",(e=>{Ne(Pt,{type:"impact",impact_style:e})})),Ot("notificationOccurred",(e=>{Ne(Pt,{type:"notification",notification_type:e})})),Ot("selectionChanged",(()=>{Ne(Pt,{type:"selection_change"})}));const Tt="web_app_open_invoice",Lt=Ge("invoice",Tt),jt=xe(!1);function Dt(e){return Object.fromEntries(Object.entries(e).filter((e=>void 0!==e[1])))}Lt("open",(async function(e,t,n){if(jt())throw new j(Be,"An invoice is already opened");let r;if("url"===t){const{hostname:t,pathname:n}=new URL(e,window.location.href);if("t.me"!==t)throw new j(Ue,`Link has unexpected hostname: ${t}`);const o=n.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!o)throw new j("ERR_INVALID_SLUG",'Expected to receive a link with a pathname in format "/invoice/{slug}" or "/${slug}"');[,,r]=o}else r=e,n=t;return jt.set(!0),De(Tt,"invoice_closed",{...n,params:{slug:r},capture:e=>r===e.slug}).then((e=>e.status)).finally((()=>{jt.set(!1)}))}));const Nt=xe(!1),qt=xe(!1),Ut=xe({});function Vt(e){return Pe((()=>Ut()[e]))}const Bt=Vt("bgColor"),Wt=Vt("buttonColor"),Ft=Vt("buttonTextColor"),Mt=Vt("bottomBarBgColor"),Ht=Vt("secondaryBgColor"),Jt=xe({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,text:"Continue"}),Gt=Pe((()=>{const e=Jt();return{...e,backgroundColor:e.backgroundColor||Wt()||"#2481cc",textColor:e.textColor||Ft()||"#ffffff"}})),Yt=xe(!1),Kt="main_button_pressed",Zt="mainButton",zt=ot(Zt),Xt=At(Zt,Yt);function Qt(){throw new j("ERR_VARS_ALREADY_BOUND","CSS variables are already bound")}zt("mount",(()=>{if(!Yt()){const e=Ce()&&H(Zt);e&&Jt.set(e),Yt.set(!0)}})),zt("onClick",(e=>ae(Kt,e))),zt("offClick",(e=>{ve(Kt,e)})),Xt("setParams",(e=>{Jt.set({...Jt(),...Dt(e)}),M(Zt,Jt());const t=Gt();t.text&&Ne("web_app_setup_main_button",{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,text:t.text,text_color:t.textColor})}));const en="themeParams",tn=ot(en);At(en,Nt)("bindCssVars",(e=>{function t(e){Object.entries(Ut()).forEach((([t,n])=>{n&&e(t,n)}))}function n(){t(((t,n)=>{Y(e(t),n)}))}return qt()&&Qt(),e||(e=e=>`--tg-theme-${J(e)}`),n(),Ut.sub(n),qt.set(!0),()=>{t(K),Ut.unsub(n),qt.set(!1)}}));const nn=tn("mount",(()=>{Nt()||(ae("theme_changed",rn),Ut.set(Ce()&&H(en)||me().themeParams),Nt.set(!0))})),rn=e=>{const t=function(e){return u()(e)}(e.theme_params);Ut.set(t),M(en,t)};function on(e){return Pe((()=>{const t=e();return a(t)?t:"bg_color"===t?Bt():Ht()}))}const sn=xe("bg_color"),an=on(sn),cn=xe("bottom_bar_bg_color"),un=Pe((()=>{const e=cn();return a(e)?e:"bottom_bar_bg_color"===e?Mt()||Ht():"secondary_bg_color"===e?Ht():Bt()})),pn=xe("bg_color"),ln=on(pn),_n=xe(!1),fn=xe(!1),dn=xe(!0),hn=Pe((()=>({backgroundColor:sn(),bottomBarColor:cn(),headerColor:pn(),isActive:dn()}))),bn="web_app_set_background_color",wn="web_app_set_bottom_bar_color",gn="web_app_set_header_color",mn="miniApp",yn={any:[bn,wn,gn]},vn=ot(mn),En=Ge(mn,yn),An=Je(mn,_n,yn);An("bindCssVars",(e=>{fn()&&Qt();const[t,n]=N();function r(e,n){function r(){Y(e,n()||null)}r(),t(n.sub(r),K.bind(null,e))}return e||(e=e=>`--tg-${J(e)}`),r(e("bgColor"),an),r(e("bottomBarColor"),un),r(e("headerColor"),ln),t((()=>{fn.set(!1)})),fn.set(!0),n})),vn("close",(e=>{Ne("web_app_close",{return_back:e})}));const Sn=e=>{dn.set(e.is_visible),Rn()};function Rn(){M(mn,hn())}En("mount",(()=>{if(!_n()){const e=Ce()&&H(mn);nn(),Cn.ifAvailable(e?e.backgroundColor:"bg_color"),$n.ifAvailable(e?e.bottomBarColor:"bottom_bar_bg_color"),kn.ifAvailable(e?e.headerColor:"bg_color"),dn.set(!e||e.isActive),ae("visibility_changed",Sn),_n.set(!0)}})),vn("ready",(()=>{Ne("web_app_ready")}));const Cn=An("setBackgroundColor",(e=>{e!==sn()&&(Ne(bn,{color:e}),sn.set(e),Rn())}),bn),$n=An("setBottomBarColor",(e=>{e!==cn()&&(Ne(wn,{color:e}),cn.set(e),Rn())}),wn),kn=An("setHeaderColor",(e=>{e!==pn()&&(Ne(gn,a(e)?{color:e}:{color_key:e}),pn.set(e),Rn())}),gn,{rgb:[gn,"color",a]});function xn(e){const t=e.message.trim(),n=(e.title||"").trim(),r=e.buttons||[];if(n.length>64)throw new j(qe,`Invalid title: ${n}`);if(!t||t.length>256)throw new j(qe,`Invalid message: ${t}`);if(r.length>3)throw new j(qe,`Invalid buttons count: ${r.length}`);return{title:n,message:t,buttons:r.length?r.map(((e,t)=>{const n=e.id||"";if(n.length>64)throw new j(qe,`Button with index ${t} has invalid id: ${n}`);if(!e.type||"default"===e.type||"destructive"===e.type){const r=e.text.trim();if(!r||r.length>64)throw new j(qe,`Button with index ${t} has invalid text: ${r}`);return{type:e.type,text:r,id:n}}return{type:e.type,id:n}})):[{type:"close",id:""}]}}const In="web_app_open_popup",Pn=Ge("popup",In),On=xe(!1);Pn("open",(async e=>{if(On())throw new j(Be,"A popup is already opened");On.set(!0);try{const{button_id:t=null}=await De(In,"popup_closed",{...e,params:xn(e)});return t}finally{On.set(!1)}}));const Tn="web_app_open_scan_qr_popup",Ln=Ge("qrScanner",Tn),jn=Ln("close",(()=>{Dn.set(!1),Ne("web_app_close_scan_qr_popup")})),Dn=xe(!1);Ln("open",(function(e){return V.withFn((t=>{if(Dn())throw new j(Be,"The QR Scanner is already opened");Dn.set(!0),e||(e={});const{onCaptured:n,text:r,capture:o}=e,[,s]=N(Dn.sub((()=>{i.resolve()})),ae("scan_qr_popup_closed",(()=>{Dn.set(!1)})),ae("qr_text_received",(e=>{n?n(e.data):(!o||o(e.data))&&(i.resolve(e.data),jn())}))),i=new W({abortSignal:t}).catch(jn).finally(s);return(e.postEvent||Ne)(Tn,{text:r}),i}),e)}));const Nn=xe({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,position:"left",text:"Cancel"}),qn=Pe((()=>{const e=Nn();return{...e,backgroundColor:e.backgroundColor||un()||"#000000",textColor:e.textColor||Wt()||"#2481cc"}})),Un=xe(!1),Vn="web_app_setup_secondary_button",Bn="secondary_button_pressed",Wn="secondaryButton",Fn=Ge(Wn,Vn),Mn=Je(Wn,Un,Vn);Fn("mount",(()=>{if(!Un()){const e=Ce()&&H(Wn);e&&Nn.set(e),Un.set(!0)}})),Fn("onClick",(e=>ae(Bn,e))),Fn("offClick",(e=>{ve(Bn,e)})),Mn("setParams",(e=>{Nn.set({...Nn(),...Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e)))}),M(Wn,Nn());const t=qn();t.text&&Ne(Vn,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,position:t.position,text:t.text,text_color:t.textColor})}));const Hn="web_app_setup_settings_button",Jn="settings_button_pressed",Gn="settingsButton",Yn=xe(!1),Kn=xe(!1),Zn=Ge(Gn,Hn),zn=Je(Gn,Kn,Hn);function Xn(e){e!==Yn()&&(Ne(Hn,{is_visible:e}),M(Gn,e),Yn.set(e))}zn("hide",(()=>{Xn(!1)})),Zn("mount",(()=>{Kn()||(Xn(Ce()&&H(Gn)||!1),Kn.set(!0))})),Zn("onClick",(e=>ae(Jn,e))),Zn("offClick",(e=>{ve(Jn,e)})),zn("show",(()=>{Xn(!0)}));const Qn="web_app_setup_swipe_behavior",er="swipeBehavior",tr=xe(!1),nr=xe(!0),rr=Ge(er,Qn),or=Je(er,tr,Qn);function sr(e,t){(e!==nr()||t)&&(Ne(Qn,{allow_vertical_swipe:e}),M(er,e),nr.set(e))}or("disableVertical",(()=>{sr(!1)})),or("enableVertical",(()=>{sr(!0)})),rr("mount",(()=>{tr()||(sr(Ce()&&H(er)||!1,!0),tr.set(!0))}));const ir="viewport",ar="web_app_request_fullscreen",cr="fullscreen_changed",ur="web_app_request_safe_area",pr="web_app_request_content_safe_area",lr={left:0,top:0,bottom:0,right:0};function _r(e){return Math.max(e,0)}const fr=xe({contentSafeAreaInsets:lr,height:0,isExpanded:!1,isFullscreen:!1,safeAreaInsets:lr,stableHeight:0,width:0});function dr(e){return Pe((()=>fr()[e]))}function hr(e){const{height:t,stableHeight:n,width:r}=e;fr.set({...fr(),...Dt({...e,height:t?_r(t):void 0,width:r?_r(r):void 0,stableHeight:n?_r(n):void 0})}),M(ir,fr())}const br=dr("isFullscreen"),wr=xe(),gr=xe(),mr=xe(!1),yr=xe(void 0),vr=xe(),Er=Je(ir,mr,ar);function Ar(e,t){return Er(e,nt((e=>De(t,[cr,"fullscreen_failed"],e).then((e=>{if("error"in e){if("ALREADY_FULLSCREEN"===e.error)return!0;throw new j("ERR_FULLSCREEN_FAILED","Fullscreen request failed",e.error)}return e.is_fullscreen})).then((e=>{e!==br()&&hr({isFullscreen:e})}))),(()=>new j(Ve,"Fullscreen mode change is already being requested")),wr,gr))}Ar("requestFullscreen",ar),Ar("exitFullscreen","web_app_exit_fullscreen");const Sr=ot(ir),Rr=At(ir,mr);function Cr(e){return Pe((()=>$r()[e]))}const $r=dr("safeAreaInsets"),kr=Cr("bottom"),xr=Cr("left"),Ir=Cr("right"),Pr=Cr("top");function Or(e){return Pe((()=>Tr()[e]))}const Tr=dr("contentSafeAreaInsets"),Lr=Or("bottom"),jr=Or("left"),Dr=Or("right"),Nr=Or("top"),qr=Me("requestContentSafeAreaInsets",(e=>De(pr,"content_safe_area_changed",e)),{isSupported:pr}),Ur=Me("requestSafeAreaInsets",(e=>De(ur,"safe_area_changed",e)),{isSupported:ur});const Vr=e=>{const{height:t}=e;hr({isExpanded:e.is_expanded,height:t,width:e.width,stableHeight:e.is_state_stable?t:void 0})},Br=e=>{hr({isFullscreen:e.is_fullscreen})},Wr=e=>{hr({safeAreaInsets:e})},Fr=e=>{hr({contentSafeAreaInsets:e})};Sr("mount",rt(ir,(e=>V.resolve().then((async()=>{const t=Ce()&&H(ir);if(t)return t;const[n,r]=await V.all([Ur.ifAvailable(e)||$r(),qr.ifAvailable(e)||Tr()]),o=me(),s={contentSafeAreaInsets:r,isFullscreen:!!o.fullscreen,safeAreaInsets:n};if(["macos","tdesktop","unigram","webk","weba","web"].includes(o.platform)){const e=window;return{...s,height:e.innerHeight,isExpanded:!0,stableHeight:e.innerHeight,width:e.innerWidth}}return function(e){return De("web_app_request_viewport","viewport_changed",e).then((e=>({height:e.height,width:e.width,isExpanded:e.is_expanded,isStable:e.is_state_stable})))}(e).then((e=>({...s,height:e.height,isExpanded:e.isExpanded,stableHeight:e.isStable?e.height:0,width:e.width})))}))),(e=>{ae("viewport_changed",Vr),ae(cr,Br),ae("safe_area_changed",Wr),ae("content_safe_area_changed",Fr),hr(e)}),mr,vr,yr));const Mr=xe(!1),Hr=dr("height"),Jr=dr("stableHeight"),Gr=dr("width");Rr("bindCssVars",(e=>{Mr()&&Qt(),e||(e=e=>`--tg-viewport-${J(e)}`);const t=[["height",Hr],["stableHeight",Jr],["width",Gr],["safeAreaInsetTop",Pr],["safeAreaInsetBottom",kr],["safeAreaInsetLeft",xr],["safeAreaInsetRight",Ir],["contentSafeAreaInsetTop",Nr],["contentSafeAreaInsetBottom",Lr],["contentSafeAreaInsetLeft",jr],["contentSafeAreaInsetRight",Dr]].reduce(((t,[n,r])=>{const o=e(n);if(o){const e=()=>{Y(o,`${r()}px`)};t.push([e,r.sub(e),o])}return t}),[]);return t.forEach((e=>{e[0]()})),Mr.set(!0),()=>{t.forEach((e=>{e[1](),K(e[2])})),Mr.set(!1)}})),Sr("expand",(()=>{Ne("web_app_expand")}));const Yr=ot()("openLink",((e,t)=>{if("string"==typeof e)try{e=new URL(e)}catch(n){throw new j(Ue,`"${e.toString()}" is invalid URL`,n)}t||(t={}),Ne("web_app_open_link",{url:e.toString(),try_browser:t.tryBrowser,try_instant_view:t.tryInstantView})})),Kr="web_app_open_tg_link",Zr=ot()("openTelegramLink",(e=>{const t=e.toString();if(!t.match(/^https:\/\/t.me\/.+/))throw new j(Ue,`"${t}" is invalid URL`);Re(Kr,Le())?(e=new URL(e),Ne(Kr,{path_full:e.pathname+e.search})):window.location.href=t})),zr=ot()("shareURL",((e,t)=>{Zr("https://t.me/share/url?"+new URLSearchParams({url:e,text:t||""}).toString().replace(/\+/g,"%20"))}));export{Zr as P,zr as h,Yr as m};
